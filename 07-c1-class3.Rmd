\clearpage
## Class 3: The inclusion-exclusion formula

The next proposition generalises the result $\mathbf{P}(A \cup B) = \mathbf{P}(A) + \mathbf{P}(B) - \mathbf{P}(A \cap B)$; it is called the _inclusion-exclusion formula_.

:::{.theorem}
\[
\mathbf{P} \left( \bigcup_{i=1}^{n} A_i\right) = P_1 - P_2 + P_3 - \ldots + (-1)^{n+1}P_n
\]
where for $1\leq k \leq n$
\[
P_k = \sum_{1\leq i_1 < i_2 < \ldots < i_k \leq n} \mathbf{P} (A_{i_1} \cap A_{i_2} \cap \ldots \cap A_{i_k}) 
\]
:::

:::{.proof}
As stated, the case $n = 2$ is from the previous proposition. In general we proceed by induction on $n$.  Assume the formula holds for $\displaystyle \mathbf{P} \left( \bigcup_{i=1}^{n} A_i\right)$. Treating $\displaystyle \bigcup_{i=1}^{n+1} A_i$ as the union of $\displaystyle \bigcup_{i=1}^{n} A_i$ and $A_{n+1}$. Using the result $\mathbf{P}(A \cup B) = \mathbf{P}(A) + \mathbf{P}(B) - \mathbf{P}(A \cap B).$
gives
\begin{align*}
\mathbf{P} \left( \bigcup_{i=1}^{n+1} A_i\right) &=
\mathbf{P} \left( \bigcup_{i=1}^{n} A_i\right) + \mathbf{P}(A_{n+1}) - \mathbf{P}  \left(\left(\bigcup_{i=1}^{n} A_i  \right)\bigcap A_{n+1} \right) \\
&=
\mathbf{P} \left( \bigcup_{i=1}^{n} A_i\right) + \mathbf{P}(A_{n+1}) - \mathbf{P}  \left(\bigcup_{i=1}^{n} (A_i \cap A_{n+1}) \right)
\end{align*}
Now apply the induction hypothesis; that is, the inclusion-exclusion formula for the union of $n$ event to expand the first and third terms 
\[
\mathbf{P} \left( \bigcup_{i=1}^{n} A_i\right) = P_1 - P_2 + P_3 - \ldots + (-1)^{n+1}P_n
\]
and
\[
\mathbf{P} \left(\bigcup_{i=1}^{n} (A_i \cap A_{n+1}) \right)
= Q_1 - Q_2 + Q_3 - \ldots + (-1)^{n+1} Q_n
\]
where 
\[
Q_k =
\sum_{1\leq i_1 < i_2 < \ldots < i_k \leq n} \mathbf{P} (A_{i_1} \cap A_{i_2} \cap \ldots \cap A_{i_k} \cap A_{n+1}) 
\]
Now observe that,
\[
P_1 + \mathbf{P}(A_{n+1}) = \sum_{i=1}^{n+1} \mathbf{P} (A_i),
\]
and that for $k = 2, 3, \ldots , n$
\[
P_k + Q_{k-1} =
\sum_{1\leq i_1 < i_2 < \ldots < i_k \leq n+1} \mathbf{P} (A_{i_1} \cap A_{i_2} \cap \ldots \cap A_{i_k} ) 
\]
and finally that
\[
Q_n = \mathbf{P}(A_1 \cap A_2 \ldots  \cap  A_{n+1} )
\]
and we have obtained the inclusion-exclusion formula for the union $\displaystyle \bigcup_{i=1}^{n+1} A_i$.
:::

### Examples

We finish with some examples that apply the inclusion-exclusion formula.

:::{.example}
An integer is selected at random from the set $\{ 1, 2, \ldots , 100 \}$. Assume that all numbers are equally likely to be selected.

1. Determine the probability that the selected number is a multiple of 4 or 5 or 7.

2. Determine the probability that the selected number is divisible by 4, but not by 5 or by 7.
::::


:::{.solution}
&nbsp;

1. Let $A$ be the event the selected integer is a multiple of 4, $B$ be the event the selected integer is a multiple of 5 and $C$ be the event the selected integer is a multiple of 7. By the inclusion-exclusion formula,

\[
\mathbf{P} (A \cup B \cup C) = \mathbf{P}(A) + \mathbf{P}(B) + \mathbf{P}(C) - \mathbf{P}(A \cap B) - \mathbf{P}(A \cap C) - \mathbf{P}(B \cap C) + \mathbf{P}(A \cap B \cap C)
\]

Since all numbers are equally likely to be selected we obtain 
\[
\mathbf{P}(A) = \frac{25}{100}, \quad \mathbf{P}(B) = \frac{20}{100}, \quad \mathbf{P}(C) = \frac{14}{100}
\]
Similarly,
\[
\mathbf{P}(A \cap B) = \frac{5}{100}, \quad \mathbf{P}(A \cap C) = \frac{3}{100}, \quad \mathbf{P}(B \cap C) = \frac{2}{100}, \quad \mathbf{P}(A \cap B \cap C) = \frac{0}{100}.
\]
Therefore,
\[
\mathbf{P} (A \cup B \cup C) = \frac{25}{100} + \frac{20}{100} + \frac{14}{100} - \frac{5}{100} - \frac{3}{100} - \frac{2}{100} + 0 = \frac{49}{100}.
\]

2. We require $\mathbf{P}(A \cap B^c \cap C^c)$. Using De Morgan's law and additivitiy
\begin{align*}
\mathbf{P}(A \cap B^c \cap C^c) &= \mathbf{P}(B^c \cap C^c) - \mathbf{P}(A^c \cap B^c \cap C^c) \\
&= 1 - \mathbf{P}(B \cup C) - (1 - \mathbf{P} (A \cup B \cup C) ) \\
&= \mathbf{P} (A \cup B \cup C) - \mathbf{P} ( B \cup C) \\
&= \frac{49}{100} - \frac{32}{100} \\
&= \frac{17}{100}
\end{align*}

_Note_ You can solve both parts by writing down the numbers between 1 and 100 with the required properties. For example,
\[
A \cap B^c \cap C^c = \{ 4,8,12,16,24,32,36,44,48,52,64,68,72,76,88,92,96 \}
\]
which contains 17 outcomes.
:::

:::{.example}
Suppose that an $n$ digit numerical code is generated uniformly at random from the set $\{0, 1, 2, 3, 4, 5, 6, 7, 8, 9\}^n$. Determine the
probability that each of the digits 1,2 and 3 occurs at least one in the code?
::::

:::{.solution}
There are two potential approaches, attempt to enumerate all the possibilities where at least one of 1, 2, 3 occur, or consider the complementary case where numbers 1, 2, 3 do not occur in the code. 

Let $A_i$ be the event that the digit $i$ does not occur in the code. Then there are $9^n$ such codes out of a
total of $10^n$ possible codes and so $\mathbf{P}(A_i ) = \left(\dfrac{9}{10}\right)^n$. 

The event of interest is $A^c_1 \cap A^c_2 \cap A^c_3 = (A_1\cup A_2\cup A_3 )^c$; that is, the complement of the event that 1, 2 or 3 do not appear in the code. 

Overall, we wish to determine
\[
\mathbf{P}(A^c_1 \cap A^c_2 \cap A^c_3 ) = 1 - \mathbf{P}(A_1\cup  A_2 \cup A_3 ) 
\]
The events $A_1$, $A_2$ and $A_3$ are not disjoint but we can calculate the probability of their union using the inclusion-exclusion formula; that is,
\[
\mathbf{P}(A_1\cup  A_2 \cup A_3 ) = \mathbf{P}(A_1) + \mathbf{P}(A_2) + \mathbf{P}(A_3) - \mathbf{P}(A_1 \cap A_2) - \mathbf{P}(A_1 \cap A_3) - \mathbf{P}(A_2 \cap A_3) + \mathbf{P}(A_1\cap A_2 \cap A_3).
\]
There are $8^n$ codes that do not contain either of the digits 1 or 2 and so
$\mathbf{P}(A_1\cap  A_2 ) = \left(\frac{8}{10}\right)^n$. Likewise $\mathbf{P}(A_2\cap  A_3 ) = \mathbf{P}(A_1 \cap A_3 ) = \left(\frac{8}{10}\right)^n$. Finally, there are $7^n$ codes that do not contain either of the digits 1, 2 or 3 and so $\mathbf{P}(A_1 \cap A_2 \cap A_3 ) = \left(\frac{7}{10}\right)^n.$
Thus
\[
\mathbf{P}(A^c_1 \cap A^c_2 \cap A^c_3 ) = 1 - \mathbf{P}(A_1\cup  A_2 \cup A_3 ) = 1 - 3\times\left(\frac{9}{10}\right)^n + 3\times\left(\frac{8}{10}\right)^n - \left(\frac{7}{10}\right)^n.
\]
:::

:::{.example}
A game consists of a rectangular table. The table is ruled into 5cm by 10 cm rectangles. A player throws a circular counter with diameter 1cm onto the table. The player wins if the coin crosses a side of one of the rectangles.  Probabilities are assigned to events so that they are proportional to the area of the corresponding subset of the rectangle. Determine the probability that the player wins. (We assume the coin always lands on the table!)
::::


:::{.solution}
The centre $x$ of the coin must land in one rectangle so we may consider this single rectangle. Since the points in the rectangle correspond to the possible landing positions of the centre of the coin, the sample space is the set of points $R$ in this rectangle. The problem is equivalent to randomly choosing a point $x$ in a geometric region $R$. If $r$ is a subregion of $R$, what is the probability that the point $x$ belongs to $r$, it seems reasonable that this is
\[
\frac{\mbox{Area of }r}{\mbox{Area of }R}.
\] 
The sides of the rectangle can be viewed as a pair of horizontal and vertical line segments.  Let $B$ be the event the player wins. Let $A_1$ be the the event that the coin crosses a horizontal side and $A_2$ the event that the coin crosses a vertical side. Then the probability that the coin will cross a side is $\mathbf{P}(B) = \mathbf{P}(A_1\cup A_2)$. The following diagram on figure \@ref(fig:table) illustrates the sample space and the events $A_1$ and $A_2$.

```{r table, out.width = "50%", fig.align='center', fig.cap = 'Geometry of the problem.', echo=FALSE} 
knitr::include_graphics('images/ST111_C1_Geometric_Probability_Example.png')
```

Observe that the player loses if the centre of the coin lands in the unshaded rectangle 4cm by 9cm.  Therefore, 
\[
\mathbf{P} ( B^c) = \frac{4\times 9}{5\times 10} = \frac{18}{25}.
\]
Since $\mathbf{P}(B) + \mathbf{P}(B^c) = 1$, it follows that $\mathbf{P}(B) = 1 - \dfrac{18}{25} = \dfrac{7}{25}$. 
:::
